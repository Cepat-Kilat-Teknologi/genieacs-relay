{{/*
Secret - Stores sensitive data (API keys)
Only created if NOT using existingSecret
*/}}

{{- if and .Values.config.nbiAuth.enabled (not .Values.config.nbiAuth.existingSecret) }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "genieacs-relay.fullname" . }}-nbi
  labels:
    {{- include "genieacs-relay.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.config.nbiAuth.key }}
  NBI_AUTH_KEY: {{ .Values.config.nbiAuth.key | b64enc | quote }}
  {{- else }}
  {{/* Generate random key if not set */}}
  NBI_AUTH_KEY: {{ randAlphaNum 64 | b64enc | quote }}
  {{- end }}
{{- end }}

{{- if and .Values.config.middlewareAuth.enabled (not .Values.config.middlewareAuth.existingSecret) }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "genieacs-relay.fullname" . }}-auth
  labels:
    {{- include "genieacs-relay.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.config.middlewareAuth.key }}
  AUTH_KEY: {{ .Values.config.middlewareAuth.key | b64enc | quote }}
  {{- else }}
  AUTH_KEY: {{ randAlphaNum 64 | b64enc | quote }}
  {{- end }}
{{- end }}
