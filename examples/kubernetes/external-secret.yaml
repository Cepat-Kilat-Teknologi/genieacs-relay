# ExternalSecret - Sync secrets from external providers
# Install: https://external-secrets.io/
#
# Supports: AWS Secrets Manager, HashiCorp Vault, GCP Secret Manager,
#           Azure Key Vault, and more

apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: genieacs-relay-secret
  namespace: genieacs
  labels:
    app.kubernetes.io/name: genieacs-relay
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: aws-secrets-manager  # or: vault, gcp-secrets, azure-keyvault
  target:
    name: genieacs-relay-secret
    creationPolicy: Owner
    template:
      type: Opaque
      metadata:
        labels:
          app.kubernetes.io/name: genieacs-relay
  data:
    - secretKey: NBI_AUTH_KEY
      remoteRef:
        key: genieacs/relay  # Path in secret manager
        property: nbi_auth_key
    - secretKey: AUTH_KEY
      remoteRef:
        key: genieacs/relay
        property: auth_key

---
# Example ClusterSecretStore for AWS Secrets Manager
apiVersion: external-secrets.io/v1beta1
kind: ClusterSecretStore
metadata:
  name: aws-secrets-manager
spec:
  provider:
    aws:
      service: SecretsManager
      region: ap-southeast-1
      auth:
        jwt:
          serviceAccountRef:
            name: external-secrets
            namespace: external-secrets

---
# Example ClusterSecretStore for HashiCorp Vault
# apiVersion: external-secrets.io/v1beta1
# kind: ClusterSecretStore
# metadata:
#   name: vault
# spec:
#   provider:
#     vault:
#       server: "https://vault.example.com"
#       path: "secret"
#       version: "v2"
#       auth:
#         kubernetes:
#           mountPath: "kubernetes"
#           role: "external-secrets"
